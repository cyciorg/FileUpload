<%- include('../public/partials/header', {title: "Shortener" }) %>

  <div class="container">
    <div></div>
    <form class="box">
      <div class="field">
        <label class="label">URL Shortener</label>
        <div class="control">
          <input class="input is-dark" required type="url" placeholder="URL Here" id="inputURL">
          <input class="input is-dark" required type="password" placeholder="API token here" id="inputToken">
          <button class="button is-info is-rounded" id="buttonSubmitID">Shrink This!</button>
        </div>
      </div>
  </div>
  </form>
  </div>
  <script>
    // thanks to Vikasdeep Singh for this oddly specific url regex test
    function isValidURL(string) {
      var res = string.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g);
      return (res !== null)
    };

    var el = document.getElementById("buttonSubmitID");
    el.addEventListener("click", avoidNSError, false); //Firefox

function avoidNSError(){
  ElementInterval = setInterval(function () {
    var url = document.getElementById("inputURL").value;
    var token = document.getElementById("inputToken").value;
      if (isValidURL(url)) {
        console.log("posting!")
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "http://localhost:8884/api/v1/shorten", true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify({
          "url": url,
          "authorization": token
        }));
      }
  clearInterval(ElementInterval);
 },0);

};
  </script>

  <%- include('../public/partials/footer') -%>